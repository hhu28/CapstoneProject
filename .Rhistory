load("~/Downloads/interferon.Rmd")
load("~/Downloads/interferon.Rmd")
View(data1)
install.packages(Stan)
Sys.setenv(MAKEFLAGS = "-j4")
source('http://mc-stan.org/rstan/install.R', echo = TRUE, max.deparse.length = 2000)
install_rstan()
library(rstan)
source('http://mc-stan.org/rstan/install.R', echo = TRUE, max.deparse.length = 2000)
install_rstan()
source("http://www.columbia.edu/~bg2382/mi/install_mi.R")
source("http://www.columbia.edu/~bg2382/mi/install_mi.R")
library(mi)
data(nlsyV,package="mi")
mdf=missing_data.frame(nlsyV)
example("mi-package")
image(mdf,grayscale=T)#missing patterns
hist(mdf)
hist(mdf)
example("mi-package")
source("http://www.columbia.edu/~bg2382/mi/install_mi.R")
install.packages(x)
example("mi-package")
mdf = read.csv("nlsyV.csv")
hist(mdf)
f1 <- function(x, y) {
x+y
}
f1(4,5)
info <- function(x,y) {
-x/(x + y) * log2(x/(x+y)) - y/(x + y) * log2(y/(x + y))
}
info(4,6)
-4/10 * log(4/10) - 6/10 * log(6/10)
-4/10 * log2(4/10) - 6/10 * log2(6/10)
110 / 165 * info(30,80) + 31/ 165 * info(5,26) + 14/165 * info(10,4) + 10/165 * info(4,6)
20 /165 * info(0,20) + 49/ 165 * info(0,49) + 79/165 * info(35,44) + 10/165 * info(10,0) + 3/165 * info(3,0)
log2(0)
info(0,20)
log2(0) + log2(20/20)
log2(20/20)
79/165 * info(35,44)
63/165 * info(40,23)
0.899 - 0.361
(30 + 5 + 13 + 4) / 165
(103 + 10) / 165
(30 + 5 + 13 + 4)
(103 + 10)
m1 = c(31.5, 32.2, 20.7, 20.6, 31.0, 43.0, 37.7, 26.0, 21.5, 26.0)
m2 = c(22.4, 18.5, 22.4, 19.6, 20.7, 20.4, 22.1, 29.4, 26.2, 35.0)
t.test(m1, m2)
t.test(m1, m2, paired = T)
t.test(m1, m2, paired = F)
?distance
?dist
dist(c(2,9), c(7,4))
dist(rbind(c(2,9), c(7,4))
)
dist(rbind(c(2,9), c(7,4)))
dist(rbind(c(2,9), c(7,4)), method = "euclidean")
dist(rbind(c(2,9), c(3,5)), method = "euclidean")
dist(rbind(c(2,9), c(7,4)), method = "euclidean")
dist(rbind(c(2,9), c(7,5)), method = "euclidean")
dist(rbind(c(2,9), c(5,5)), method = "euclidean")
dist(rbind(c(2,9), c(4,8)), method = "euclidean")
dist(rbind(c(5,7), c(3,5)), method = "euclidean")
dist(rbind(c(5,7), c(7,4)), method = "euclidean")
dist(rbind(c(5,7), c(7,5)), method = "euclidean")
dist(rbind(c(5,7), c(5,5)), method = "euclidean")
dist(rbind(c(5,7), c(4,8)), method = "euclidean")
dist(rbind(c(1,2), c(3,5)), method = "euclidean")
dist(rbind(c(1,2), c(7,4)), method = "euclidean")
dist(rbind(c(1,2), c(7,5)), method = "euclidean")
dist(rbind(c(1,2), c(5,5)), method = "euclidean")
dist(rbind(c(1,2), c(4,8)), method = "euclidean")
center = mean(c(5,7), c(3,5), c(7,4), c(7,5), c(5,5), c(4,8))
center = avg(c(5,7), c(3,5), c(7,4), c(7,5), c(5,5), c(4,8))
center = mean(rbind(c(5,7), c(3,5), c(7,4), c(7,5), c(5,5), c(4,8)))
center
rbind(c(5,7), c(3,5), c(7,4), c(7,5), c(5,5), c(4,8))
m = rbind(c(5,7), c(3,5), c(7,4), c(7,5), c(5,5), c(4,8))
center = apply(m, mean, 2)
?apply
center = apply(m, 2, mean)
center
(6-15)^2 + (12 - 15)^2 + (18 - 15)^2 + (24 - 15)^2  + (30 - 40)^2 + (42 - 40)^2  + (48 - 40)^2
m1 = c(31.5, 32.2, 20.7, 20.6, 31.0, 43.0, 37.7, 26.0, 21.5, 26.0)
m2 = c(22.4, 18.5, 22.4, 19.6, 20.7, 20.4, 22.1, 29.4, 26.2, 35.0)
t.test(m1, m2, paired = F)
library(nnet)
getwd()
setwd('~/Dropbox/CARES')
data = read.csv('life_threatening.csv')
data.describe
data.describe()
data.describe()
data.describe()
len(data)
data.length
ggplot(data=data, aes(x=factor(Age_interval), y = life_threatening, fill=Industry)) + geom_bar(stat="identity")
library(ggplot2)
ggplot(data=data, aes(x=factor(Age_interval), y = life_threatening, fill=Industry)) + geom_bar(stat="identity")
head(data)
aggregate(life_threatening ~ Industry, data, FUN=sum)
t1 = aggregate(life_threatening ~ Industry, data, FUN=sum)
sum(t1$life_threatening)
t1[order(t1$life_threatening), ]
t1[-order(t1$life_threatening), ]
t1[order(-t1$life_threatening), ]
ggplot(data=data[which(data$Industry %in% c('Unconventional_food',
'Fishery',
'Cosmetics',
'Dietary Conv Food'
'Bakery Prod'
'Soft Drink')]
, aes(x=factor(Age_interval), y = life_threatening, fill=Industry)) + geom_bar(stat="identity")
ggplot(data=data[which(data$Industry %in% c('Unconventional_food',
'Fishery',
'Cosmetics',
'Dietary Conv Food'
'Bakery Prod'
'Soft Drink')),]
, aes(x=factor(Age_interval), y = life_threatening, fill=Industry)) + geom_bar(stat="identity")
ggplot(data=data[which(data$Industry %in% c('Unconventional_food',
'Fishery',
'Cosmetics',
'Dietary Conv Food',
'Bakery Prod',
'Soft Drink')),]
, aes(x=factor(Age_interval), y = life_threatening, fill=Industry)) + geom_bar(stat="identity")
#+ theme(axis.text.x = element_text(angle = 30))
ggplot(data=data[which(data$Industry %in% c('Unconventional_food',
'Fishery',
'Cosmetics',
'Dietary Conv Food',
'Bakery Prod',
'Soft Drink')),]
, aes(x=factor(Age_interval), y = life_threatening, fill=Industry))
ggplot(data=data[which(data$Industry %in% c('Unconventional_food',
'Fishery',
'Cosmetics',
'Dietary Conv Food',
'Bakery Prod',
'Soft Drink')),]
, aes(x=factor(Age_interval), y = life_threatening, fill=Industry)) + geom_bar()
ggplot(data=data[which(data$Industry %in% c('Unconventional_food',
'Fishery',
'Cosmetics',
'Dietary Conv Food',
'Bakery Prod',
'Soft Drink')),]
, aes(x=factor(Age_interval), y = life_threatening, fill=Industry)) + geom_bar(stat="identity")
pie_chart = read.csv('pie_chart.csv')
pie = ggplot(data[which(data$life_threatening == 1)], aes(x="", y=life_threatening, fill=industry_pie chart))+ geom_bar(stat = "identity")
pie = ggplot(data[which(data$life_threatening == 1)],
aes(x="", y=life_threatening, fill=industry_pie chart))+ geom_bar(stat = "identity")
pie = ggplot(data[which(data$life_threatening == 1)],
aes(y=life_threatening, fill=industry_pie chart))+ geom_bar(stat = "identity")
pie = ggplot(data[which(data$life_threatening == 1)], aes(x = '', y=life_threatening,
fill=industry_pie chart))+ geom_bar(stat = "identity")
pie = ggplot(data[which(data$life_threatening == 1)], aes(x = '', y=life_threatening, fill=industry_pie chart))
pie = ggplot(pie_chart[which(data$life_threatening == 1)], aes(x = '', y=life_threatening, fill=industry_pie chart))
pie = ggplot(pie_chart[which(data$life_threatening == 1)], aes(x = '', y=life_threatening, fill=industry))
pie = ggplot(pie_chart[which(pie_chart$life_threatening == 1)], aes(x = '', y=life_threatening, fill=industry))
ggplot(data=data[which(data$Industry %in% c('Unconventional_food',
'Fishery',
'Cosmetics',
'Dietary Conv Food',
'Bakery Prod',
'Soft Drink')),]
, aes(x=factor(Age_interval), y = life_threatening, fill=Industry)) + geom_bar(stat="identity")
ggplot(data=data[which(data$Industry %in% c('Unconventional_food',
'Fishery',
'Cosmetics',
'Dietary Conv Food',
'Bakery Prod',
'Soft Drink')),]
, aes(x=factor(Age_interval), y = life_threatening, fill=Industry)) + geom_bar(stat="")
ggplot(data=data[which(data$Industry %in% c('Unconventional_food',
'Fishery',
'Cosmetics',
'Dietary Conv Food',
'Bakery Prod',
'Soft Drink')),]
, aes(x=factor(Age_interval), y = life_threatening, fill=Industry)) + geom_bar(stat="identity")
ggplot(data=data[which(data$Industry %in% c('Unconventional_food',
'Fishery',
'Cosmetics',
'Dietary Conv Food',
'Bakery Prod',
'Soft Drink')),]
, aes(x=factor(Age_interval), y = life_threatening, fill=Industry)) +
geom_bar(stat="identity", position=position_dodge())
geom_bar(stat="count", position=position_dodge())
ggplot(data=data[which(data$Industry %in% c('Unconventional_food',
'Fishery',
'Cosmetics',
'Dietary Conv Food',
'Bakery Prod',
'Soft Drink')),]
, aes(x=factor(Age_interval), y = life_threatening, fill=Industry)) +
geom_bar(stat="count", position=position_dodge())
ggplot(data=data[which(data$Industry %in% c('Unconventional_food',
'Fishery',
'Cosmetics',
'Dietary Conv Food',
'Bakery Prod',
'Soft Drink') & (data$life_threatening == 1), ),]
, aes(x=factor(Age_interval), fill=Industry)) +
geom_bar(stat="count", position=position_dodge())
t1 = aggregate(life_threatening ~ Industry + Age_interval, data, FUN=sum)
t1[order(-t1$life_threatening), ]
ggplot(data=data[which(data$Industry %in% c('Unconventional_food',
'Fishery',
'Cosmetics',
'Dietary Conv Food',
'Bakery Prod',
'Soft Drink') & (data$life_threatening == 1), ),]
, aes(x=factor(Age_interval), fill=Industry)) +
geom_bar(stat="count", position=position_dodge()) + geom_text()
ggplot(data=data[which(data$Industry %in% c('Unconventional_food',
'Fishery',
'Cosmetics',
'Dietary Conv Food',
'Bakery Prod',
'Soft Drink') & (data$life_threatening == 1), ),]
, aes(x=factor(Age_interval), fill=Industry)) +
geom_bar(stat="count", position=position_dodge()) + geom_text(aes(label= count), position=position_dodge(width=0.9), vjust=-0.25)
#
ggplot(data=data[which(data$Industry %in% c('Unconventional_food',
'Fishery',
'Cosmetics',
'Dietary Conv Food',
'Bakery Prod',
'Soft Drink') & (data$life_threatening == 1), ),]
, aes(x=factor(Age_interval), fill=Industry)) +
geom_bar(stat="count", position=position_dodge()) + geom_text(stat='bin',aes(label=..count..),vjust=-1)
ggplot(data=data[which(data$Industry %in% c('Unconventional_food',
'Fishery',
'Cosmetics',
'Dietary Conv Food',
'Bakery Prod',
'Soft Drink') & (data$life_threatening == 1), ),]
, aes(x=factor(Age_interval), fill=Industry)) +
geom_bar(stat="count", position=position_dodge()) + geom_text(stat='count',aes(label=..count..),vjust=-1)
p1 = ggplot(data=data[which(data$Industry %in% c('Unconventional_food',
'Fishery',
'Cosmetics',
'Dietary Conv Food',
'Bakery Prod',
'Soft Drink') & (data$life_threatening == 1), ),]
, aes(x=factor(Age_interval), fill=Industry)) +
geom_bar(stat="count", position=position_dodge()) +
fad
p1 = ggplot(data=data[which(data$Industry %in% c('Unconventional_food',
'Fishery',
'Cosmetics',
'Dietary Conv Food',
'Bakery Prod',
'Soft Drink') & (data$life_threatening == 1), ),]
, aes(x=factor(Age_interval), fill=Industry)) +
geom_bar(stat="count", position=position_dodge())
p1 + geom_text(stat='count',aes(label=..count..),vjust=.25)
p1 + geom_text(stat='count',aes(label=..count..),vjust=-.25)
p1 = ggplot(data=data[which(data$Industry %in% c('Unconventional_food',
'Fishery',
'Cosmetics',
'Dietary Conv Food',
'Bakery Prod',
'Soft Drink') & (data$life_threatening == 1), ),]
, aes(x=factor(Age_interval), fill=Industry)) +
geom_bar(stat="count", position=position_dodge(width=0.9))
p1 + geom_text(stat='count',aes(label=..count..),vjust=-.25)
p1 + geom_text(stat='count',aes(label=..count..),position=position_dodge(width=.9), size=4vjust=-.25)
p1 + geom_text(stat='count',aes(label=..count..),position=position_dodge(width=.9), size=4, vjust=-.25)
s1 = data[which(data$Industry %in% c('Unconventional_food',
'Fishery',
'Cosmetics',
'Dietary Conv Food',
'Bakery Prod',
'Soft Drink')), ]
m1 <- glm(life_threatening ~ Industry + Age_interval + gender , data = s1, family = "binomial")
m1 <- glm(life_threatening ~ Industry + Age_interval + Gender , data = s1, family = "binomial")
summary(m1)
s2 = data[which(data$Industry %in% c('Unconventional_food',
'Fishery',
'Cosmetics',
'Dietary Conv Food',
'Bakery Prod',
'Soft Drink') & data$Age_interval == '21-40'), ]
m2 <- glm(life_threatening ~ Industry + Gender, data = s2, family = "binomial")
summary(m2)
m2 <- glm(life_threatening ~ Industry + Age + Gender, data = s2, family = "binomial")
summary(m2)
m2 <- glm(life_threatening ~ Industry + Gender, data = s2, family = "binomial")
summary(m2)
s3 = data[which(data$Industry %in% c('Unconventional_food',
'Fishery',
'Cosmetics',
'Dietary Conv Food',
'Bakery Prod',
'Soft Drink') & data$Age_interval == '41-60'), ]
m3 <- glm(life_threatening ~ Industry + Gender, data = s3, family = "binomial")
summary(m3)
s4 = data[which(data$Industry %in% c('Unconventional_food',
'Fishery',
'Cosmetics',
'Dietary Conv Food',
'Bakery Prod',
'Soft Drink') & data$Age_interval == '61-80'), ]
m4 <- glm(life_threatening ~ Industry + Gender, data = s4, family = "binomial")
summary(m4)
s5 = data[which(data$Industry %in% c('Unconventional_food',
'Fishery',
'Cosmetics',
'Dietary Conv Food',
'Bakery Prod',
'Soft Drink') & data$Age_interval == '61-80'), ]
m5 <- glm(life_threatening ~ Industry + Gender, data = s5, family = "binomial")
summary(m5)
all = count(data[which(data$Industry %in% c('Unconventional_food',
'Fishery',
'Cosmetics',
'Dietary Conv Food',
'Bakery Prod',
'Soft Drink')),], c('Industry', 'Age_interval'))
library(plyr)
all = count(data[which(data$Industry %in% c('Unconventional_food',
'Fishery',
'Cosmetics',
'Dietary Conv Food',
'Bakery Prod',
'Soft Drink')),], c('Industry', 'Age_interval'))
all
life = count(data[which(data$Industry %in% c('Unconventional_food',
'Fishery',
'Cosmetics',
'Dietary Conv Food',
'Bakery Prod',
'Soft Drink') & life_threatening == 1),], c('Industry', 'Age_interval'))
life = count(data[which(data$Industry %in% c('Unconventional_food',
'Fishery',
'Cosmetics',
'Dietary Conv Food',
'Bakery Prod',
'Soft Drink') & data$life_threatening == 1),], c('Industry', 'Age_interval'))
prop = life/all
life
all
prop.table(life)
prop.table(life,1)
prop = life/all
m = merge(all, life)
m
m
all
m = rbind(all, life)
m
m = cbind(all, life)
m = merge(all, life, all.x = True)
m = merge(all, life, all.x = TRUE)
m
all
m = merge(all, life, all.freq = freq1,  all.x = TRUE)
m
m = merge(all, life, all.x = TRUE, all.y = TRUE)
m
m = merge(all, life, by = c('Industry', 'Age_interval'),  all.x = TRUE, all.y = TRUE)
m
m$prop = m$freq.y / m$freq.x
m
cbind(all,life)
cbind(all,life)
p2 = ggplot(data=m, aes(x=Age_interval, y = prop, fill=Industry)) + geom_bar(stat="identity", position=position_dodge(width=0.9))
p2
all = count(data[which(data$Industry %in% c('Unconventional_food',
'Fishery',
'Dietary Conv Food',
'Bakery Prod',
'Soft Drink')),], c('Industry', 'Age_interval'))
life = count(data[which(data$Industry %in% c('Unconventional_food',
'Fishery',
'Dietary Conv Food',
'Bakery Prod',
'Soft Drink') & data$life_threatening == 1),], c('Industry', 'Age_interval'))
m = merge(all, life, by = c('Industry', 'Age_interval'),  all.x = TRUE, all.y = TRUE)
p2 = ggplot(data=m, aes(x=Age_interval, y = prop, fill=Industry)) + geom_bar(stat="identity", position=position_dodge(width=0.9))
p2
m$prop = m$freq.y / m$freq.x
p2 = ggplot(data=m, aes(x=Age_interval, y = prop, fill=Industry)) + geom_bar(stat="identity", position=position_dodge(width=0.9))
p2
p2 + labs(y = "Proportion of life threatening outcomes")
png('p3.png')
p2 + labs(y = "Proportion of life threatening outcomes", x = "Age interval")
dev.off()
png('p4.png')
p1 + labs(x = "Age interval", y = "frequency") + geom_text(stat='count',aes(label=..count..),position=position_dodge(width=.9), size=4, vjust=-.25)
dev.off()
write.csv(m)
write.table(m,'m.csv')
write.csv(m,'m.csv')
wrte(m, 'm.docx')
write(m, 'm.docx')
s2 = data[which(data$Industry %in% c('Unconventional_food',
'Fishery',
'Cosmetics',
'Dietary Conv Food',
'Bakery Prod',
'Soft Drink') & data$Age_interval == '21-40'), ]
m2 <- glm(life_threatening ~ Industry + Gender, data = s2, family = "binomial")
summary(m2)
m2 <- glm(life_threatening ~ Industry * Gender, data = s2, family = "binomial")
summary(m2)
m2 <- glm(life_threatening ~ Industry + Gender, data = s2, family = "binomial")
summary(m2)
l <- cbind(0, 0, 0, -1, 1, 0, 0, 0)
wald.test(b = coef(m2), Sigma = vcov(m2), L = l)
library(aov)
library(aod)
install.packages("aod")
library(aod)
wald.test(b = coef(m2), Sigma = vcov(m2), L = l)
summary(m3)
l <- cbind(0, -1, 0, 1, 0, 0, 0, 0)
library(aod)
wald.test(b = coef(m2), Sigma = vcov(m2), L = l)
summary(m4)
l <- cbind(0, -1, -1, 1, -1, -1, 0, 0)
library(aod)
wald.test(b = coef(m2), Sigma = vcov(m2), L = l)
l <- cbind(0, -1, 0, 1, 0, 0, 0, 0)
wald.test(b = coef(m2), Sigma = vcov(m2), L = l)
l <- cbind(0, -1, 0, 1, 0, 0, 0, 0)
wald.test(b = coef(m3), Sigma = vcov(m3), L = l)
l <- cbind(0, -1, -1, 1, -1, -1, 0, 0)
wald.test(b = coef(m3), Sigma = vcov(m3), L = l)
summary(m3)
summary(m4)
l <- cbind(0, -1, -1, 1, -1, -1, 0, 0)
wald.test(b = coef(m2), Sigma = vcov(m2), L = l)
l <- cbind(0, -1, -1, 1, -1, -1, 0, 0)
wald.test(b = coef(m3), Sigma = vcov(m3), L = l)
summary(m3)
summary(m4)
wald.test(b = coef(m4), Sigma = vcov(m4), L = l)
l <- cbind(0, -1/4, -1/4, 1, -1/4, -1/4, 0, 0)
wald.test(b = coef(m4), Sigma = vcov(m4), L = l)
l <- cbind(0, -1, -1, 1, -1, -1, 0, 0)
wald.test(b = coef(m4), Sigma = vcov(m4), L = l)
